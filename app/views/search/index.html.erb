<!-- app/views/search/index.html.erb -->
<div class="bg-[#45483c] text-[#1a202c] flex items-center justify-center min-h-screen">
  <script>

    const speechRecognition = new window.webkitSpeechRecognition();
const searchBar = document.getElementById("searchBar");

function handleResult({ results }) {
  // Get the input element by its ID
  var inputElement = document.getElementById("searchBar");

  // Access the transcribed text
  const capturedText = results[0][0].transcript;

  // Set the value of the input element so we can search
  inputElement.value = capturedText;
}

function searchDictation() {
  speechRecognition.start();
  speechRecognition.onresult = handleResult;
}

function showPlaceholder() {
  // Display the placeholder text
  alert("Placeholder: " + placeholderText);
}

  </script>
    <div class="text-center w-full">
      <img src="./assets/ecosearch.png" alt="logo" class="h-40 w-50 mx-auto" />
      <div class="relative mx-auto max-w-xl">
        <div
          class="absolute inset-y-0 left-4 sm:left-0 pl-3 flex items-center pointer-events-none"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5 text-gray-600"
            viewBox="0 0 20 20"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <circle cx="8.5" cy="8.5" r="7" />
            <line x1="13.5" y1="13.5" x2="17.5" y2="17.5" />
          </svg>
        </div>
    <%= form_with url: search_index_path, method: :get, local: true, class: "space-y-4" do |form| %>
        <div class="pl-5 pr-5 sm:pl-0 sm:pr-0">
          <%= form.text_field :query,  autocomplete: "off", type: "text", id: "searchBar", placeholder: "Enter search term", class: "block w-full mx-auto h-12 pl-10 pr-4 py-3 text-sm rounded-full bg-gray-300 placeholder-gray-500 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#f1f6e5]" %>
        </div>
      </div>

      <div
        class="px-auto mx-auto flex items-center justify-center gap-2 w-auto pt-4"
      >
        <%= form.submit "Search", class: "relative block w-auto px-2 py-[5px] overflow-hidden text-[16px] bg-[#303134] text-center text-[#e8eaed] rounded-[4px] transition border border-[#303134] hover:border hover:border-[#5f6368]" %>
        <button
          onclick="searchDictation()"
          class="relative block w-auto px-2 py-[5px] overflow-hidden text-[16px] bg-[#303134] text-center text-[#e8eaed] rounded-[4px] transition border border-[#303134] hover:border hover:border-[#5f6368]"
        >
          Dictation
        </button>
      </div>
    </div>
    <% end %>

  <% if @results && @results['items'] %>
    <h2 class="text-2xl font-bold mt-8">Results</h2>
    <div class="space-y-4 mt-4">
      <% @results['items'].each do |result| %>
        <div class="p-4 border border-gray-300 rounded-md shadow-sm">
          <h3 class="text-xl font-semibold">
            <a href="<%= result['link'] %>" class="text-indigo-600 hover:underline"><%= result['title'] %></a>
          </h3>
          <p class="text-gray-700"><%= result['snippet'] %></p>
        </div>
      <% end %>
    </div>
  <% elsif @results && @results['webPages'] && @results['webPages']['value'] %>
    <h2 class="text-2xl font-bold mt-8">Results</h2>
    <div class="space-y-4 mt-4">
      <% @results['webPages']['value'].each do |result| %>
        <div class="p-4 border border-gray-300 rounded-md shadow-sm">
          <h3 class="text-xl font-semibold">
            <a href="<%= result['url'] %>" class="text-indigo-600 hover:underline"><%= result['name'] %></a>
          </h3>
          <p class="text-gray-700"><%= result['snippet'] %></p>
        </div>
      <% end %>
    </div>
  <% else %>
    <p class="text-gray-700 mt-4">No results found.</p>
  <% end %>
</div>
